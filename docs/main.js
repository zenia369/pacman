(()=>{"use strict";class i{static width=40;static height=40;constructor({position:i,image:t}){this.position=i,this.width=40,this.height=40,this.image=t}draw(){g.drawImage(this.image,this.position.x,this.position.y)}}class t{static speed=2;static play=!0;constructor({position:i,velocity:t,color:e="red"}){this.position=i,this.velocity=t,this.color=e,this.radius=15,this.prevCollisions=[],this.speed=5,this.scared=!1}draw(){g.beginPath(),g.arc(this.position.x,this.position.y,this.radius,0,2*Math.PI),g.fillStyle=this.scared?"blue":this.color,g.fill(),g.closePath()}update(){this.draw(),this.position.x+=this.velocity.x,this.position.y+=this.velocity.y}}const e=[],s=[],o=[];function a(i){const t=new Image;return t.src=i,t}const n=new class{constructor({position:i,velocity:t}){this.position=i,this.velocity=t,this.radius=15,this.radians=.75,this.openRate=.12,this.rortation=0}draw(){g.save(),g.translate(this.position.x,this.position.y),g.rotate(this.rortation),g.translate(-this.position.x,-this.position.y),g.beginPath(),g.arc(this.position.x,this.position.y,this.radius,this.radians,2*Math.PI-this.radians),g.lineTo(this.position.x,this.position.y),g.fillStyle="yellow",g.fill(),g.closePath(),g.restore()}update(){this.draw(),this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,(this.radians<0||this.radians>.75)&&(this.openRate=-this.openRate),this.radians+=this.openRate}}({position:{x:i.width+i.width/2,y:i.height+i.height/2},velocity:{x:0,y:0}}),r={w:{pressed:!1},a:{pressed:!1},s:{pressed:!1},d:{pressed:!1}},c={lastKey:"",score:0},h=[new t({position:{x:6*i.width+i.width/2,y:3*i.height+i.height/2},velocity:{x:t.speed,y:0}})];class l{static play=!0;constructor({position:i}){this.position=i,this.radius=3}draw(){g.beginPath(),g.arc(this.position.x,this.position.y,this.radius,0,2*Math.PI),g.fillStyle="white",g.fill(),g.closePath()}}class p{static play=!0;constructor({position:i}){this.position=i,this.radius=8}draw(){g.beginPath(),g.arc(this.position.x,this.position.y,this.radius,0,2*Math.PI),g.fillStyle="green",g.fill(),g.closePath()}}function y({circle:t,ractangle:e}){const s=i.width/2-t.radius-1;return t.position.y-t.radius+t.velocity.y<=e.position.y+e.height+s&&t.position.x+t.radius+t.velocity.x>=e.position.x-s&&t.position.y+t.radius+t.velocity.y>=e.position.y-s&&t.position.x-t.radius+t.velocity.x<=e.position.x+e.width+s}window.addEventListener("keydown",(({key:i})=>{switch(i){case"w":r.w.pressed=!0,c.lastKey="w";break;case"a":r.a.pressed=!0,c.lastKey="a";break;case"s":r.s.pressed=!0,c.lastKey="s";break;case"d":r.d.pressed=!0,c.lastKey="d"}})),window.addEventListener("keyup",(({key:i})=>{switch(i){case"w":r.w.pressed=!1;break;case"a":r.a.pressed=!1;break;case"s":r.s.pressed=!1;break;case"d":r.d.pressed=!1}})),document.querySelector("#start").addEventListener("click",(()=>{t.play=!1,l.play=!1,p.play=!1})),document.querySelector("#regame").addEventListener("click",(()=>{window.location.reload()})),[["1","-","-","-","-","-","-","-","-","-","2"],["|"," "," "," "," "," "," "," "," ","4","|"],["|"," ","x"," ","x"," ","<",">"," "," ","|"],["|"," "," "," "," "," "," "," ","x"," ","|"],["|"," ","<","-",">"," ","x","*"," "," ","|"],["|"," "," "," "," "," "," "," ","x"," ","|"],["|"," ","x"," ","x"," ","<",">"," "," ","|"],["|"," "," "," "," "," "," "," "," ","1","|"],["4","-","-","-","-","-","-","-","-","-","3"]].forEach(((t,n)=>{t.forEach(((t,r)=>{switch(t){case"-":o.push(new i({position:{x:i.width*r,y:i.height*n},image:a("./images/pipeHorizontal.png")}));break;case"|":o.push(new i({position:{x:i.width*r,y:i.height*n},image:a("./images/pipeVertical.png")}));break;case!!/[0-9]/.test(t)&&t:o.push(new i({position:{x:i.width*r,y:i.height*n},image:a(`./images/pipeCorner${t}.png`)}));break;case"x":o.push(new i({position:{x:i.width*r,y:i.height*n},image:a("./images/block.png")}));break;case">":o.push(new i({position:{x:i.width*r,y:i.height*n},image:a("./images/capRight.png")}));break;case"<":o.push(new i({position:{x:i.width*r,y:i.height*n},image:a("./images/capLeft.png")}));break;case"^":o.push(new i({position:{x:i.width*r,y:i.height*n},image:a("./images/capTop.png")}));break;case"_":o.push(new i({position:{x:i.width*r,y:i.height*n},image:a("./images/capBottom.png")}));break;case"+":o.push(new i({position:{x:i.width*r,y:i.height*n},image:a("./images/pipeCross.png")}));break;case"*":s.push(new p({position:{x:r*i.width+i.width/2,y:n*i.height+i.height/2}}));break;default:e.push(new l({position:{x:r*i.width+i.width/2,y:n*i.height+i.height/2}}))}}))}));const d=document.querySelector("canvas"),g=d.getContext("2d");d.width=innerWidth/1.7,d.height=innerHeight;const u=document.querySelector("#score");let w;!function i(){if(w=requestAnimationFrame(i),g.clearRect(0,0,d.width,d.height),r.w.pressed&&"w"===c.lastKey)for(let i=0;i<o.length;i++){const t=o[i];if(y({circle:{...n,velocity:{x:0,y:-5}},ractangle:t})){n.velocity.y=0;break}n.velocity.y=-5}else if(r.a.pressed&&"a"===c.lastKey)for(let i=0;i<o.length;i++){const t=o[i];if(y({circle:{...n,velocity:{x:-5,y:0}},ractangle:t})){n.velocity.x=0;break}n.velocity.x=-5}else if(r.s.pressed&&"s"===c.lastKey)for(let i=0;i<o.length;i++){const t=o[i];if(y({circle:{...n,velocity:{x:0,y:5}},ractangle:t})){n.velocity.y=0;break}n.velocity.y=5}else if(r.d.pressed&&"d"===c.lastKey)for(let i=0;i<o.length;i++){const t=o[i];if(y({circle:{...n,velocity:{x:5,y:0}},ractangle:t})){n.velocity.x=0;break}n.velocity.x=5}for(let i=s.length-1;0<=i;i--){const t=s[i];t.draw(),Math.hypot(t.position.x-n.position.x,t.position.y-n.position.y)<t.radius+n.radius&&!p.play&&(s.splice(i,1),h.forEach((i=>{i.scared=!0,setTimeout((()=>{i.scared=!1}),3e3)})))}for(let i=h.length-1;0<=i;i--){const e=h[i];Math.hypot(e.position.x-n.position.x,e.position.y-n.position.y)<e.radius+n.radius&&!t.play&&(e.scared?h.splice(i,1):(cancelAnimationFrame(w),document.querySelector("#lost").classList.remove("hidden")))}o.forEach((i=>{i.draw(),y({circle:n,ractangle:i})&&(n.velocity.y=0,n.velocity.x=0)}));for(let i=e.length-1;0<i;i--){const t=e[i],s=i;t.draw(),Math.hypot(t.position.x-n.position.x,t.position.y-n.position.y)<t.radius+n.radius&&!l.play&&(e.splice(s,1),c.score+=10,u.innerHTML=c.score)}e.length-1==0&&(cancelAnimationFrame(w),document.querySelector("#win").classList.remove("hidden")),n.update(),h.forEach(((i,e)=>{i.update();const s=[];if(o.forEach((e=>{!s.includes("right")&&y({circle:{...i,velocity:{x:t.speed,y:0}},ractangle:e})&&s.push("right"),!s.includes("left")&&y({circle:{...i,velocity:{x:-t.speed,y:0}},ractangle:e})&&s.push("left"),!s.includes("up")&&y({circle:{...i,velocity:{x:0,y:-t.speed}},ractangle:e})&&s.push("up"),!s.includes("down")&&y({circle:{...i,velocity:{x:0,y:t.speed}},ractangle:e})&&s.push("down")})),s.length>i.prevCollisions.length&&(i.prevCollisions=s),JSON.stringify(s)!==JSON.stringify(i.prevCollisions)){i.velocity.x>0?i.prevCollisions.push("right"):i.velocity.x<0?i.prevCollisions.push("left"):i.velocity.y<0?i.prevCollisions.push("up"):i.velocity.y>0&&i.prevCollisions.push("down");const e=i.prevCollisions.filter((i=>!s.includes(i)));switch(e[Math.floor(Math.random()*e.length)]){case"down":i.velocity.y=t.speed,i.velocity.x=0;break;case"up":i.velocity.y=-t.speed,i.velocity.x=0;break;case"right":i.velocity.y=0,i.velocity.x=t.speed;break;case"left":i.velocity.y=0,i.velocity.x=-t.speed}i.prevCollisions=[]}})),n.velocity.x>0?n.rortation=0:n.velocity.x<0?n.rortation=Math.PI:n.velocity.y>0?n.rortation=Math.PI/2:n.velocity.y<0&&(n.rortation=1.5*Math.PI)}()})();